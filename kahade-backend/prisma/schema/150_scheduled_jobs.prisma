// ============================================================================
// SCHEDULED JOBS & AUTOMATION
// ============================================================================

model ScheduledJob {
  id           String             @id @default(uuid())
  jobType       String             @map("job_type")
  entityType    String?            @map("entity_type")
  entityId      String?            @map("entity_id")

  scheduledAt   DateTime           @map("scheduled_at")
  executedAt    DateTime?          @map("executed_at")

  status        ScheduledJobStatus  @default(PENDING)
  retryCount    Int                @default(0) @map("retry_count")
  maxRetries    Int                @default(3) @map("max_retries")

  payload       Json?
  result        Json?
  errorMessage  String?            @map("error_message") @db.Text

  createdAt     DateTime           @default(now()) @map("created_at")

  // Idempotency
  idempotencyKey String?           @map("idempotency_key")

  @@index([jobType, status, scheduledAt])
  @@index([scheduledAt, status])
  @@index([entityType, entityId])
  @@map("scheduled_jobs")
}
