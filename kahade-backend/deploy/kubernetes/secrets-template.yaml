# ============================================================================
# KUBERNETES SECRETS CONFIGURATION - TEMPLATE
# ============================================================================
# ⚠️  CRITICAL SECURITY INSTRUCTIONS:
#
# 1. NEVER commit actual secrets to version control
# 2. Use this template to create actual secrets.yaml
# 3. Add secrets.yaml to .gitignore (already done)
# 4. Use one of these secure methods:
#
# METHOD 1: Kubernetes Secrets (Base64 encoded)
# ----------------------------------------------
# Create secrets from literal values:
# kubectl create secret generic kahade-secrets \
#   --from-literal=DATABASE_URL='postgresql://...' \
#   --from-literal=JWT_SECRET='...' \
#   --from-literal=REDIS_PASSWORD='...' \
#   --namespace=kahade
#
# METHOD 2: External Secrets Operator (RECOMMENDED)
# --------------------------------------------------
# Use AWS Secrets Manager, HashiCorp Vault, or Google Secret Manager
# Install: https://external-secrets.io/
#
# METHOD 3: Sealed Secrets (GitOps-friendly)
# -------------------------------------------
# Encrypt secrets that can be safely stored in Git
# Install: https://github.com/bitnami-labs/sealed-secrets
#
# ============================================================================

apiVersion: v1
kind: Secret
metadata:
  name: kahade-secrets
  namespace: kahade
  labels:
    app: kahade-backend
    environment: production
type: Opaque

# ============================================================================
# OPTION 1: Base64 Encoded Secrets (Manual)
# ============================================================================
# Generate base64 values:
# echo -n 'your-secret-value' | base64
#
# Example:
# data:
#   DATABASE_URL: <base64-encoded-database-url>
#   JWT_SECRET: <base64-encoded-jwt-secret>
#   JWT_REFRESH_SECRET: <base64-encoded-refresh-secret>
#   REDIS_PASSWORD: <base64-encoded-redis-password>
#   COOKIE_SECRET: <base64-encoded-cookie-secret>
#   MIDTRANS_SERVER_KEY: <base64-encoded-midtrans-key>
#   XENDIT_SECRET_KEY: <base64-encoded-xendit-key>
#   MAIL_PASSWORD: <base64-encoded-mail-password>
#   BLOCKCHAIN_PRIVATE_KEY_KMS_ARN: <base64-encoded-kms-arn>

data: {}
  # Replace with actual base64-encoded secrets
  # DATABASE_URL: ""
  # JWT_SECRET: ""
  # JWT_REFRESH_SECRET: ""
  # REDIS_PASSWORD: ""
  # COOKIE_SECRET: ""
  # MIDTRANS_SERVER_KEY: ""
  # XENDIT_SECRET_KEY: ""
  # MAIL_PASSWORD: ""

---
# ============================================================================
# OPTION 2: External Secrets (RECOMMENDED FOR PRODUCTION)
# ============================================================================
# Requires External Secrets Operator installed
# Reference: https://external-secrets.io/

apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: kahade-external-secrets
  namespace: kahade
spec:
  refreshInterval: 1h
  
  # Choose your secrets backend
  secretStoreRef:
    name: aws-secrets-manager  # or vault-backend, gcpsm-backend
    kind: SecretStore
  
  target:
    name: kahade-secrets
    creationPolicy: Owner
  
  data:
    # AWS Secrets Manager example
    - secretKey: DATABASE_URL
      remoteRef:
        key: kahade/production/database-url
    
    - secretKey: JWT_SECRET
      remoteRef:
        key: kahade/production/jwt-secret
    
    - secretKey: JWT_REFRESH_SECRET
      remoteRef:
        key: kahade/production/jwt-refresh-secret
    
    - secretKey: REDIS_PASSWORD
      remoteRef:
        key: kahade/production/redis-password
    
    - secretKey: COOKIE_SECRET
      remoteRef:
        key: kahade/production/cookie-secret
    
    - secretKey: MIDTRANS_SERVER_KEY
      remoteRef:
        key: kahade/production/midtrans-server-key
    
    - secretKey: XENDIT_SECRET_KEY
      remoteRef:
        key: kahade/production/xendit-secret-key
    
    - secretKey: MAIL_PASSWORD
      remoteRef:
        key: kahade/production/mail-password
    
    - secretKey: BLOCKCHAIN_PRIVATE_KEY_KMS_ARN
      remoteRef:
        key: kahade/production/blockchain-kms-arn

---
# ============================================================================
# SECRET STORE CONFIGURATION (for External Secrets)
# ============================================================================

# AWS Secrets Manager
apiVersion: external-secrets.io/v1beta1
kind: SecretStore
metadata:
  name: aws-secrets-manager
  namespace: kahade
spec:
  provider:
    aws:
      service: SecretsManager
      region: us-east-1
      auth:
        jwt:
          serviceAccountRef:
            name: kahade-backend

---
# ============================================================================
# DEPLOYMENT CHECKLIST
# ============================================================================
# Before deploying to production:
#
# [ ] All secrets are stored in secure secrets manager (AWS/GCP/Vault)
# [ ] Secrets are NOT committed to version control
# [ ] RBAC is configured to limit secret access
# [ ] Secrets rotation policy is implemented
# [ ] Audit logging is enabled for secret access
# [ ] Backup and disaster recovery plan is in place
# [ ] Secrets are encrypted at rest and in transit
# [ ] Service accounts have minimal required permissions
# [ ] Regular security audits are scheduled
# ============================================================================
